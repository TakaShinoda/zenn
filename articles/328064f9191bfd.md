---
title: 'Rust ã§åˆã‚ã¦ã® npm package é–‹ç™º'
emoji: 'ğŸ“¦'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['npm', 'vite', 'vue', 'rust']
published: false
---

# ã¯ã˜ã‚ã«

ç­†è€…ã¯æœ€è¿‘ Rust ã®å­¦ç¿’ã‚’å§‹ã‚ã¾ã—ãŸã€‚
ãã®ä¸­ã§ã€å®Ÿéš›ã«ä½•ã‹å‹•ãã‚‚ã®ã‚’ä½œã£ã¦ã¿ãŸã„ã¨æ€ã„ npm package ä½œã£ã¦ã¿ã¾ã—ãŸã€‚

# ä½œã£ãŸã‚‚ã®

æ—¥ä»˜ã‚’è¡¨ç¤ºã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

```vue
<script setup lang="ts">
import { today } from 'date-rs-t6'
</script>

<template>
  <!--Today: 2024/11/11ï¼ˆæœˆï¼‰ -->
  <p>Today: {{ today() }}</p>
</template>
```

https://www.npmjs.com/package/date-rs-t6

# ãªãŒã‚Œ

å…¨ä½“çš„ãªãªãŒã‚Œã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

- Rust ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã€WebAssembly ã‚„ TS, JS, package.json ã‚’ç”Ÿæˆ
- ãã‚Œã‚‰ã‚’ npm ã« publish
- å®Ÿéš›ã«ã€Vite + Vue ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ publish ã—ãŸãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ä½¿ç”¨

![](https://storage.googleapis.com/zenn-user-upload/1b8cc5a098de-20241110.png)

# è©³ç´°

## WebAssembly

- ã‚¦ã‚§ãƒ–ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿè¡Œã§ãã‚‹ã‚³ãƒ¼ãƒ‰
  - HTML, CSS, JavaScript, WebAssembly
- `.wasm` ã¨ã„ã†æ‹¡å¼µå­ã®ãƒã‚¤ãƒŠãƒªãƒ•ã‚¡ã‚¤ãƒ«
- C, C++, Rust ãªã©ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å…ˆã¨ã™ã‚‹ã“ã¨ãŒå¯èƒ½

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

- cargo ã‚’ä½¿ã£ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ
  - cargo ã¯ Rust ã®ãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ å…¼ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£
- ä»Šå›ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œã‚‹ãŸã‚ã€`cargo new --lib` ã‚’å®Ÿè¡Œ
- åˆæœŸã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¯ä»¥ä¸‹
  - `Cargo.toml`
  - `src` é…ä¸‹ã« `lib.rs`

```zsh
$ cargo new --lib sample-project
```

```
.
â”œâ”€â”€ Cargo.toml
â””â”€â”€  src
    â””â”€â”€ lib.rs
```

## ã‚¯ãƒ¬ãƒ¼ãƒˆ

### chrono

- ã‚°ãƒ¬ã‚´ãƒªã‚ªæš¦ã®æ—¥ä»˜ã€æ™‚åˆ»ã‚’æ“ä½œã™ã‚‹ã‚¯ãƒ¬ãƒ¼ãƒˆ
- ä»Šå›ã¯ã“ã¡ã‚‰ã‚’ä½¿ã£ã¦æ—¥ä»˜ã‚„æ›œæ—¥ã‚’å–å¾—

https://github.com/chronotope/chrono

```rust: src/lib.rs
use chrono::prelude::*;

fn today() -> String {
  let now: DateTime<Local> = Local::now();
  let day_of_week = match now.weekday() {
    Weekday::Mon => "æœˆ",
    Weekday::Tue => "ç«",
    Weekday::Wed => "æ°´",
    Weekday::Thu => "æœ¨",
    Weekday::Fri => "é‡‘",
    Weekday::Sat => "åœŸ",
    Weekday::Sun => "æ—¥",
  };

  format!("{}ï¼ˆ{}ï¼‰", now.format("%Y/%m/%d").to_string(), day_of_week)
}
```

### wasm-bindgen

- Rust ã§å®Ÿè£…ã—ãŸé–¢æ•°ã‚’ JS ãŒå‘¼ã³å‡ºã—ãŸã‚Šã€Rust ãŒ JS ã® API ã‚’å®Ÿè¡Œã§ãã‚‹
- `#[wasm_bindgen]` ã¨ã„ã†å±æ€§ã‚’ä»˜ä¸ã—ã¦ä½¿ã†

https://github.com/rustwasm/wasm-bindgen

```rust: src/lib.rs
use chrono::prelude::*;
use wasm_bindgen::prelude::*;

#[wasm_bindgen]
pub fn today() -> String {
    let now: DateTime<Local> = Local::now();
    let day_of_week = match now.weekday() {
        Weekday::Mon => "æœˆ",
        Weekday::Tue => "ç«",
        Weekday::Wed => "æ°´",
        Weekday::Thu => "æœ¨",
        Weekday::Fri => "é‡‘",
        Weekday::Sat => "åœŸ",
        Weekday::Sun => "æ—¥",
    };

    format!("{}ï¼ˆ{}ï¼‰", now.format("%Y/%m/%d").to_string(), day_of_week)
}
```

### wasm-pack

- WebAssembly ã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ã—ã¦ã€npm ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«å…¬é–‹ã§ãã‚‹
- ä»Šå›ã¯ã€`build`, `login`, `publish` ã—ã‹ä½¿ã£ã¦ã„ãªã„ãŒä»–ã«ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ãŒã‚ã‚‹
- ã‚ˆã‚Šè©³ç´°ãªå†…å®¹ã¯ä»¥ä¸‹ã®è¨˜äº‹ã‚’å‚ç…§
  - https://hacks.mozilla.org/2018/04/hello-wasm-pack/
- build ã¯ã€target ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ bundler ã‚’æŒ‡å®šã™ã‚‹

```zsh
Commands:
  build    ğŸ—ï¸  build your npm package!
  pack     ğŸ±  create a tar of your npm package but don't publish!
  new      ğŸ‘ create a new project with a template
  publish  ğŸ†  pack up your npm package and publish!
  login    ğŸ‘¤  Add an npm registry user account! (aliases: adduser, add-user)
  test     ğŸ‘©â€ğŸ”¬  test your wasm!
  help     Print this message or the help of the given subcommand(s)
```

https://github.com/rustwasm/wasm-pack

```zsh
$ wasm-pack build --target bundler
```

```
pkg
â”œâ”€â”€ README.md
â”œâ”€â”€ sample-project.d.ts
â”œâ”€â”€ sample-project.js
â”œâ”€â”€ sample-project_bg.js
â”œâ”€â”€ sample-project_bg.wasm
â”œâ”€â”€ sample-project_bg.wasm.d.ts
â””â”€â”€ package.json
```

## Vite + Vue ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨ã™ã‚‹

- create vite ã§ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å®Ÿéš›ã«å‹•ä½œç¢ºèªã‚’è¡Œã†
- å‹•ä½œç¢ºèªç’°å¢ƒã¯ä»¥ä¸‹
  - `"vue"`: `"3.5.12"`
  - `"typescript"`: `"5.6.2"`
  - `"vite"`: `"5.4.9"`

```zsh
$ npm i sample-project
```

```zsh
$ npm run dev
```

å®Ÿéš›ã«é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/92b86ddf365e-20241110.png)

ã“ã‚Œã¯å…¬å¼ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚‚è¨˜è¼‰ãŒã‚ã‚Šã€ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±ºã™ã‚‹ã«ã¯åˆ¥é€”ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å°å…¥ãŒå¿…è¦ã§ã—ãŸã€‚

> WebAssembly ã® ES ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«çµ±åˆã®ææ¡ˆã¯ç¾æ™‚ç‚¹ã§ã¯ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚ vite-plugin-wasm ã‹ã€ã‚‚ã—ãã¯ä»–ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒ¼ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦å¯¾å‡¦ã—ã¦ãã ã•ã„ã€‚

![](https://storage.googleapis.com/zenn-user-upload/751dcc2daee0-20241111.png)

https://ja.vite.dev/guide/features#webassembly

ã‚ˆã£ã¦ã€æœ€çµ‚çš„ãª `vite.config.ts` ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```ts: vite.config.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import wasm from 'vite-plugin-wasm'
import topLevelAwait from "vite-plugin-top-level-await";


export default defineConfig({
  plugins: [
    vue(),
    wasm(),
    topLevelAwait()
  ]
})
```

ã“ã‚Œã‚‰ã®å¯¾å¿œã‚’ã™ã‚‹ã“ã¨ã§ç”»é¢ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/816a33653c18-20241111.png)

# å‚è€ƒ

- https://developer.mozilla.org/ja/docs/WebAssembly/Rust_to_Wasm
- https://zenn.dev/kazuhe/articles/60e431b09aa284

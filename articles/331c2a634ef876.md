---
title: "Playwright „Åß Âà•„Çø„Éñ„Åß Instagram „Å´ÈÅ∑Áßª„Åô„Çã„ÉÜ„Çπ„Éà„ÇíÊõ∏„Åè"
emoji: "üéà"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: ['playwright', 'instagram', 'nextjs']
published: true
---

# „ÅØ„Åò„ÇÅ„Å´

ÂâçÂõû„ÅØ„ÄÅNext.js „Å® microCMS „Çí‰Ωø„Å£„Åü„Çµ„Ç§„Éà„Å´ Google Analytics „ÇíÂ∞éÂÖ•„Åó„ÄÅ‰∫∫Ê∞óË®ò‰∫ã„É©„É≥„Ç≠„É≥„Ç∞„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü„ÄÇ

https://zenn.dev/taka_shino/articles/450d773a99f904


‰ªäÂõû„ÅØ„ÄÅPlaywright „Çí‰Ωø„Å£„Å¶„ÉÜ„Çπ„Éà„ÇíÊõ∏„Åç„Åæ„Åô„ÄÇ
ÂÖ∑‰ΩìÁöÑ„Å´„ÅØ„ÄÅ„Çµ„Ç§„Éà„ÅÆ„Éò„ÉÉ„ÉÄ„Éº„Å´„ÅÇ„Çã Instagram „ÅÆ„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Ê≠£Â∏∏„Å´ Instagram „ÅÆ„Éö„Éº„Ç∏„Å´ÈÅ∑Áßª„Åß„Åç„Çã„Åã„Çí„ÉÜ„Çπ„Éà„Åó„Åæ„Åô„ÄÇ

![](https://storage.googleapis.com/zenn-user-upload/3e53ad04fad6-20220807.png)


# ÂâçÊèê
Playwright „ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´„Å®ÂàùÊúüË®≠ÂÆö„ÅØÁµÇ„Çè„Å£„Å¶„ÅÑ„Çã„ÇÇ„ÅÆ„Å®„Åó„Åæ„Åô„ÄÇ


# „ÉÜ„Çπ„Éà„ÇíÊõ∏„Åè

## Âà•„Çø„Éñ„ÅßÈñã„Åè
Instagram „ÅÆ„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å® `target="_blank"` „Å´„Çà„Å£„Å¶„ÄÅÂà•„Çø„Éñ„ÅßÈñã„Åè„Çà„ÅÜ„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ
Âà•„Çø„Éñ„ÅÆ„ÉÜ„Çπ„Éà„ÅØ‰ª•‰∏ã„ÅÆ„Éâ„Ç≠„É•„É°„É≥„Éà„ÇíÂèÇËÄÉ„Å´‰ΩúÊàê„Åó„Åæ„Åó„Åü„ÄÇ

https://playwright.dev/docs/pages#handling-new-pages


```ts: e2e/sample.spec.ts
test('„Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®„ÄÅÂà•„Çø„Éñ„Åß„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Éö„Éº„Ç∏„ÅåÈñã„Åè„Åì„Å®', async ({
  page,
  context,
}) => {
  const [instagramPage] = await Promise.all([
    context.waitForEvent('page'),
    page.locator('[data-test-transition-instagram-button]').click(),
  ])
  await instagramPage.waitForLoadState()
})
```


## Instagram „Å´„É≠„Ç∞„Ç§„É≥„Åô„Çã
Âà•„Çø„Éñ„ÅßÈñã„ÅÑ„Åü Instagram ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´Êú™„É≠„Ç∞„Ç§„É≥Áä∂ÊÖã„Åß„Åô„ÄÇ

![](https://storage.googleapis.com/zenn-user-upload/617f30d5ad67-20220807.png)

„Åì„Åì„Åß„ÄÅ„É≠„Ç∞„Ç§„É≥„Å´ÂøÖË¶Å„Å™ÊÉÖÂ†±„Çí„Éï„Ç©„Éº„É†„Å´ÂÖ•Âäõ„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ
„É¶„Éº„Ç∂„ÉºÂêç„Å®„Éë„Çπ„ÉØ„Éº„Éâ„Çí„Åù„Çå„Åû„Çå‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´ÊåáÂÆö„Åó„Å¶ÂÖ•Âäõ„Åó„Åæ„Åô„ÄÇ

```ts: e2e/sample.spec.ts
test('„Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®„ÄÅÂà•„Çø„Éñ„Åß„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Éö„Éº„Ç∏„ÅåÈñã„Åè„Åì„Å®', async ({
  page,
  context,
}) => {
  const [instagramPage] = await Promise.all([
    context.waitForEvent('page'),
    page.locator('[data-test-transition-instagram-button]').click(),
  ])
  await instagramPage.waitForLoadState()
	
  // „É≠„Ç∞„Ç§„É≥„Å´ÂøÖË¶Å„Å™ÊÉÖÂ†±„Çí„Éï„Ç©„Éº„É†„Å´ÂÖ•Âäõ
  await instagramPage.locator('input[name="username"]').fill('sample@test.com')
  await instagramPage.locator('input[name="password"]').fill('password')
})

```

‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´„Éï„Ç©„Éº„É†„Å´ÂøÖË¶Å„Å™ÊÉÖÂ†±„ÇíÂÖ•Âäõ„Åß„Åç„Åæ„Åó„Åü„ÄÇ

![](https://storage.googleapis.com/zenn-user-upload/c4288c580fd8-20220807.png)


Ê¨°„Å´„É≠„Ç∞„Ç§„É≥ÊÉÖÂ†±„ÇíÂÖ•Âäõ„Åó„ÅüÂæå„ÅØ„ÄÅ„É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åæ„Åô„ÄÇ

```ts: e2e/sample.spec.ts
test('„Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®„ÄÅÂà•„Çø„Éñ„Åß„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Éö„Éº„Ç∏„ÅåÈñã„Åè„Åì„Å®', async ({
  page,
  context,
}) => {
  const [instagramPage] = await Promise.all([
    context.waitForEvent('page'),
    page.locator('[data-test-transition-instagram-button]').click(),
  ])
  await instagramPage.waitForLoadState()
	
  // „É≠„Ç∞„Ç§„É≥„Å´ÂøÖË¶Å„Å™ÊÉÖÂ†±„Çí„Éï„Ç©„Éº„É†„Å´ÂÖ•Âäõ
  await instagramPage.locator('input[name="username"]').fill('sample@test.com')
  await instagramPage.locator('input[name="password"]').fill('password')

  // „É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
  await instagramPage.locator('button[type="submit"]').click()
})
```

„É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å™ÁîªÈù¢„Å´ÈÅ∑Áßª„Åó„Åæ„Åô„ÄÇ
„Åì„Åì„Åß„ÅØ„ÄÅ„É≠„Ç∞„Ç§„É≥ÊÉÖÂ†±„Çí„Éñ„É©„Ç¶„Ç∂„Å´‰øùÂ≠ò„Åó„Åü„Åè„Å™„ÅÑ„Åß Not Now „Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åæ„Åô„ÄÇ


![](https://storage.googleapis.com/zenn-user-upload/c667465cfd99-20220807.png)

```ts: e2e/sample.spec.ts
test('„Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®„ÄÅÂà•„Çø„Éñ„Åß„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Éö„Éº„Ç∏„ÅåÈñã„Åè„Åì„Å®', async ({
  page,
  context,
}) => {
  const [instagramPage] = await Promise.all([
    context.waitForEvent('page'),
    page.locator('[data-test-transition-instagram-button]').click(),
  ])
  await instagramPage.waitForLoadState()
	
  // „É≠„Ç∞„Ç§„É≥„Å´ÂøÖË¶Å„Å™ÊÉÖÂ†±„Çí„Éï„Ç©„Éº„É†„Å´ÂÖ•Âäõ
  await instagramPage.locator('input[name="username"]').fill('sample@test.com')
  await instagramPage.locator('input[name="password"]').fill('password')

  // „É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
  await instagramPage.locator('button[type="submit"]').click()

  // Not Now „Çí„ÇØ„É™„ÉÉ„ÇØ
  await instagramPage.locator('text=Not Now').click()

  // „É≠„Ç∞„Ç§„É≥ÂæåÈÅ∑Áßª„Åó„Åü„Éö„Éº„Ç∏„Åå /hogehoge „Åß„ÅÇ„Çã„Åì„Å®
  await expect(instagramPage).toHaveURL('https://www.instagram.com/hogehoge')
})
```

## „É≠„Ç∞„Ç§„É≥ÊÉÖÂ†±„Çí .env „Éï„Ç°„Ç§„É´„Åã„ÇâË™≠„ÅøËæº„ÇÄ

„Åì„Çå„Åæ„Åß„ÅØ„ÄÅ„É¶„Éº„Ç∂„ÉºÂêç„Å®„Éë„Çπ„ÉØ„Éº„Éâ„Çí„ÉÜ„Çπ„Éà„Éï„Ç°„Ç§„É´„Å´Êõ∏„ÅçËæº„Çì„Åß„ÅÑ„Åæ„Åó„Åü„Åå„ÄÅ`.env` „Éï„Ç°„Ç§„É´„Åã„ÇâË™≠„ÅøËæº„ÇÅ„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åô„ÄÇ
‰ª•‰∏ã„ÅÆË®ò‰∫ã„ÇíÂèÇËÄÉ„Å´„Åï„Åõ„Å¶„ÅÑ„Åü„Å†„Åç„Åæ„Åó„Åü„ÄÇ

https://zenn.dev/mimi/scraps/314e19282b7f0b

```text: .env
INSTAGRAM_LOGIN_EMAIL=sample@test.com
INSTAGRAM_LOGIN_PASS=password
```

`.env` „Éï„Ç°„Ç§„É´„Å´Ë®≠ÂÆö„Åó„ÅüÁí∞Â¢ÉÂ§âÊï∞„Çí‰ΩøÁî®„Åß„Åç„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åô„ÄÇ
```ts: e2e/global-setup.ts
import path from 'path'
import { FullConfig } from '@playwright/test'
import dotenv from 'dotenv'

dotenv.config({ path: path.resolve(process.cwd(), '.env') })

async function globalSetup(config: FullConfig) {
  // Áï•
}

export default globalSetup
```

`playwright.config.ts` „ÅÆ `globalSetup` „Å´ `global-setup.ts` „ÇíÊåáÂÆö„Åó„Åæ„Åô„ÄÇ

```ts: playwright.config.ts
import { PlaywrightTestConfig, devices } from '@playwright/test'
const PORT = process.env.PORT || 3000
const baseURL = `http://localhost:${PORT}`
const config: PlaywrightTestConfig = {
  globalSetup: require.resolve('./e2e/global-setup.ts'),
  testMatch: '/e2e/**/*.spec.ts',

  use: {
    // Áï•
  },

  projects: [
    // Áï•
  ],
}
export default config

```


`.env` „Éï„Ç°„Ç§„É´„Å´Ë®≠ÂÆö„Åó„ÅüÁí∞Â¢ÉÂ§âÊï∞„Çí‰ΩøÁî®„Åß„Åç„Çã„Çà„ÅÜ„Å™„Å£„Åü„ÅÆ„Åß„ÄÅ‰ª•‰∏ã„ÅÆ„Çà„ÅÜ„Å´„ÉÜ„Çπ„Éà„Çí‰øÆÊ≠£„Åó„Åæ„Åó„Åü„ÄÇ




```ts: e2e/sample.spec.ts
test('„Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®„ÄÅÂà•„Çø„Éñ„Åß„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Éö„Éº„Ç∏„ÅåÈñã„Åè„Åì„Å®', async ({
  page,
  context,
}) => {
  const [instagramPage] = await Promise.all([
    context.waitForEvent('page'),
    page.locator('[data-test-transition-instagram-button]').click(),
  ])
  await instagramPage.waitForLoadState()

  // .env „Éï„Ç°„Ç§„É´„Åã„ÇâË™≠„ÅøËæº„ÇÄ
  const { INSTAGRAM_LOGIN_EMAIL, INSTAGRAM_LOGIN_PASS } = process.env
	
  // „É≠„Ç∞„Ç§„É≥„Å´ÂøÖË¶Å„Å™ÊÉÖÂ†±„Çí„Éï„Ç©„Éº„É†„Å´ÂÖ•Âäõ
  await instagramPage.locator('input[name="username"]').fill(`${INSTAGRAM_LOGIN_EMAIL}`)
  await instagramPage.locator('input[name="password"]').fill(`${INSTAGRAM_LOGIN_PASS}`)

  // „É≠„Ç∞„Ç§„É≥„Éú„Çø„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ
  await instagramPage.locator('button[type="submit"]').click()

  // Not Now „Çí„ÇØ„É™„ÉÉ„ÇØ
  await instagramPage.locator('text=Not Now').click()

  // „É≠„Ç∞„Ç§„É≥ÂæåÈÅ∑Áßª„Åó„Åü„Éö„Éº„Ç∏„Åå /hogehoge „Åß„ÅÇ„Çã„Åì„Å®
  await expect(instagramPage).toHaveURL('https://www.instagram.com/hogehoge')
})
```


# „Åä„Çè„Çä„Å´
playwright„ÄÄ„Çí‰Ωø„Å£„Å¶ Instagram „ÅÆ„Éö„Éº„Ç∏„Å´ÈÅ∑Áßª„Åß„Åç„Çã„Åã„ÉÜ„Çπ„Éà„ÇíÊõ∏„ÅÑ„Å¶„Åø„Åæ„Åó„Åü„ÄÇ
ÁßÅËá™Ë∫´ e2e „ÉÜ„Çπ„Éà„ÅÆ„É©„Ç§„Éñ„É©„É™„Çí„Åï„Çè„Å£„Åü„Åì„Å®„Åå„Å™„ÅèÂ≠¶„Å≥„Å´„Å™„Çä„Åæ„Åó„Åü„ÄÇ
„Åæ„Å†„Åæ„Å†‰∏ÄÈÉ®„Åó„Åã„ÉÜ„Çπ„Éà„Åå„Å™„ÅÑÁä∂Ê≥Å„Åß„Åô„ÅÆ„Åß„ÄÅ‰ªäÂæå„ÇÇ„ÉÜ„Çπ„Éà„ÇíÊõ∏„ÅÑ„Å¶„ÅÑ„Åì„ÅÜ„Å®ÊÄù„ÅÑ„Åæ„Åó„Åü„ÄÇ

:::details ‰ªäÂõû‰ΩúÊàê„Åó„Åü„ÉÜ„Çπ„Éà„Éï„Ç°„Ç§„É´„ÅÆË©≥Á¥∞„Ç≥„Éº„Éâ
```ts: e2e/sample.spec.ts
import { test, expect } from '@playwright/test'

test.describe('index.tsx', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/')
  })

  test.describe('Header', () => {
    test('„Éò„ÉÉ„ÉÄ„Éº„ÅÆ„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Ç¢„Ç§„Ç≥„É≥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®„ÄÅÂà•„Çø„Éñ„Åß„Ç§„É≥„Çπ„Çø„Ç∞„É©„É†„ÅÆ„Éö„Éº„Ç∏„ÅåÈñã„Åè„Åì„Å®', async ({
      page,
      context,
    }) => {
      const [instagramPage] = await Promise.all([
        context.waitForEvent('page'),
        page.locator('[data-test-transition-instagram-button]').click(),
      ])
      await instagramPage.waitForLoadState()
      const { INSTAGRAM_LOGIN_EMAIL, INSTAGRAM_LOGIN_PASS } = process.env
      await instagramPage.locator('input[name="username"]').fill(`${INSTAGRAM_LOGIN_EMAIL}`)
      await instagramPage.locator('input[name="password"]').fill(`${INSTAGRAM_LOGIN_PASS}`)
      await instagramPage.locator('button[type="submit"]').click()
      await instagramPage.locator('text=Not Now').click()
      await expect(instagramPage).toHaveURL('https://www.instagram.com/hogehoge')
    })
  })
  // ‰ªñ„ÅÆ„ÉÜ„Çπ„Éà
}
```
:::


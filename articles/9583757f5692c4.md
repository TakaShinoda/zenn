---
title: 'Nuxt3, Vuetify3, Zod ã§ç®¡ç†ç”»é¢ UI ã‚’ä½œæˆã™ã‚‹'
emoji: 'ğŸ“˜'
type: 'tech' # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['nuxt3', 'vuetify3', 'zod']
published: true
---

# ã¯ã˜ã‚ã«

å…ˆæ—¥ Nuxt3.5 ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚

https://nuxt.com/blog/v3-5

ç§è‡ªèº« Nuxt3 ã‚’ã•ã‚ã£ãŸã“ã¨ãŒãªãä»Šå›ã¯ç·´ç¿’ãã® 1 ã¨ã—ã¦ã€ã‚ˆãã‚ã‚Šãã†ãªç®¡ç†ç”»é¢ã® UI ã‚’ä½œã£ã¦ã¿ã¾ã—ãŸã€‚

## ã‚„ã£ãŸã“ã¨

- Nuxt + Vuetify ã‚’ä½¿ã£ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ã‚’ä½œæˆ
- Zod ã‚’ä½¿ã£ã¦ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’ä½œæˆ

## ã‚„ã£ã¦ãªã„ã“ã¨

- å®Ÿéš›ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’ DB ã«ç™»éŒ²

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ Nuxt3 ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã§ãã¾ã™ã€‚

```
npx nuxi init <project-name>
```

https://nuxt.com/docs/getting-started/installation

# ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®ä½œæˆ

ä»Šå›ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/4150ee6a1b48-20230604.png)

Nuxt3 ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé…ä¸‹ã« layouts ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã‚Šã€éåŒæœŸã‚¤ãƒ³ãƒãƒ¼ãƒˆã«ã‚ˆã£ã¦è‡ªå‹•çš„ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚

https://nuxt.com/docs/guide/directory-structure/layouts#layouts-directory

```vue: layouts/default.vue
<template>
  <v-app>
    <Header />
    <SideNav />
    <v-main>
      <v-container>
        <slot />
      </v-container>
    </v-main>
    <Footer />
  </v-app>
</template>
```

ã¾ãŸãƒ˜ãƒƒãƒ€ãƒ¼ãªã©ã®å„ç¨®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ components ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªé…ä¸‹ã«ä½œæˆã—ã¦ã„ã¾ã™ã€‚

Nuxt ã¯ã€components ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è‡ªå‹•çš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

## Header ã®ä½œæˆ

Vuetify ã® `v-app-bar` ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

https://vuetifyjs.com/en/components/app-bars/

```vue:components/Header.vue
<template>
  <v-app-bar color="light-blue-accent-4">
    <v-app-bar-title>
      ç®¡ç†ç”»é¢
    </v-app-bar-title>
  </v-app-bar>
</template>
```

## SideNav ã®ä½œæˆ

Vuetify ã® `v-navigation-drawer` ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

https://vuetifyjs.com/en/components/navigation-drawers/

```vue:components/SideNav.vue
<script setup lang="ts">
  const menus = [
    {
      name: 'Top',
      path: '/'
    },
    {
      name: 'User',
      path: '/user'
    }
  ]
</script>

<template>
  <v-navigation-drawer permanent>
    <v-list>
      <v-list-item
        v-for="(menu, i) in menus"
        :key="i"
        :to="menu.path"
      >
        <v-list-item-title class="text-h6">
          {{ menu.name }}
        </v-list-item-title>
      </v-list-item>
    </v-list>
  </v-navigation-drawer>
</template>
```

## Footer ã®ä½œæˆ

Vuetify ã® `v-footer` ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

https://vuetifyjs.com/en/components/footers/

```vue:components/Footer.vue
<template>
  <v-footer color="light-blue-accent-4" app>
    v 0.0.1
  </v-footer>
</template>
```

## app.vue ã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’è¡¨ç¤º

`app.vue` ã« `NuxtLayout` ã‚¿ã‚°ã‚’è¿½åŠ ã—ã¦ä¸Šè¨˜ã§ä½œæˆã—ãŸãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’è¡¨ç¤ºã—ã¾ã™

```vue: app.vue
<template>
  <NuxtLayout>
    <NuxtPage />
  </NuxtLayout>
</template>
```

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ç”»é¢ã®ä½œæˆ

Nuxt3 ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé…ä¸‹ã« pages ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã—ã¾ã™ã€‚
ãã‚Œã«ã‚ˆã‚Š Vue Router ã‚’ä½¿ç”¨ã—ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã«å¯¾ã—ã¦è‡ªå‹•çš„ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãŒè¨­å®šã•ã‚Œã¾ã™ã€‚

https://nuxt.com/docs/guide/directory-structure/pages

```vue: pages/user/index.vue
<template>
  <div>
    <h1>ãƒ¦ãƒ¼ã‚¶ä¸€è¦§</h1>
    <v-sheet class="ma-4">
      <v-btn color="light-blue-accent-4" class="mt-4 w-20" to="/user/create">
        ãƒ¦ãƒ¼ã‚¶ä½œæˆ
      </v-btn>
    </v-sheet>
  </div>
</template>
```

```vue: pages/user/create.vue
<script setup lang="ts">
  const name = ref('')
  const email = ref('')
  const submit = () => {
    // å¾Œã»ã©ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’è¿½è¨˜
  }
</script>

<template>
  <div>
    <h1>ãƒ¦ãƒ¼ã‚¶ç™»éŒ²</h1>
    <v-sheet class="ma-4">
      <v-form @submit.prevent="submit">
        <v-row>
          <v-col cols="2">
            <v-list-subheader>
              ãƒ¦ãƒ¼ã‚¶å
            </v-list-subheader>
          </v-col>
          <v-col cols="10">
            <v-text-field
              v-model="name"
              label="ãƒ¦ãƒ¼ã‚¶å"
            >
            </v-text-field>
          </v-col>
        </v-row>
        <v-row>
          <v-col cols="2">
            <v-list-subheader>
              ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
            </v-list-subheader>
          </v-col>
          <v-col cols="10">
            <v-text-field
              v-model="email"
              label="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
              type="email"
            >
            </v-text-field>
          </v-col>
        </v-row>
        <v-btn color="light-blue-accent-4" type="submit" class="mt-4 w-20">Submit</v-btn>
      </v-form>
    </v-sheet>
  </div>
</template>
```

![](https://storage.googleapis.com/zenn-user-upload/cf56a05e889f-20230604.png)

# ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹

ä»Šå›ã®ç”»é¢ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ ãŒã‚ã‚Šã¾ã™ãŒã€ãã‚Œã‚‰ã®å…¥åŠ›ã«å¯¾ã—ã¦ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

`v-text-field` ã® props ã« `rules` ã‚’æ¸¡ã™ã“ã¨ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã§ãã¾ã™ãŒã€ä»Šå›ã¯ Zod ã‚’ä½¿ç”¨ã—ã¾ã—ãŸã€‚

https://vuetifyjs.com/en/api/v-text-field/#props-rules

```
npm i zod
```

https://zod.dev/

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒã®ä½œæˆ

Zod ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã§ããŸã‚‰ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚­ãƒ¼ãƒã®ä½œæˆã§ã™ã€‚

ä»Šå›ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ 2 ã¤ã®å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã«å¯¾ã—ã¦ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆã—ã¾ã—ãŸã€‚

å„ã‚¹ã‚­ãƒ¼ãƒã®è©³ç´°ã«ã¤ã„ã¦ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ãã ã•ã„ã€‚

```ts: schema/user.ts
import z from 'zod'

export const createUserSchema = z.object({
  name: z.string().nonempty(),
  email: z.string().email().nonempty()
})

export type CreateUser = z.TypeOf<typeof createUserSchema>
```

## composable é–¢æ•°ã®ä½œæˆ

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã† composable é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚

ã“ã“ã§ã¯ã€parse ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚¹ã‚­ãƒ¼ãƒã«å®šç¾©ã—ãŸãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œã¨ã€ã‚¨ãƒ©ãƒ¼ã«ãªã£ãŸã¨ãã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

Nuxt3 ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé…ä¸‹ã«ã€composables ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«è‡ªå‹•çš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚

https://nuxt.com/docs/guide/directory-structure/composables

```ts: composables/useUserValidation.ts
import { createUserSchema, CreateUser } from '@/schema/user'
import { ZodError } from 'zod'

export const useCreateUserValidation = () => {
  const errorMessages = ref<ZodError | null>(null)
  const validate = (data: CreateUser) => {
    try {
      createUserSchema.parse(data)
      if(errorMessages.value) {
        errorMessages.value = null
      }
    } catch(e) {
      if(e instanceof ZodError) {
        errorMessages.value = e
      }
    }
  }

  return {
    errorMessages,
    validate
  }
}
```

## ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…

ä¸Šè¨˜ã§ä½œæˆã—ãŸ composable é–¢æ•°ã‚’ `pages/user/create.vue` ã§ä½¿ç”¨ã—ã¾ã™ã€‚

```vue: pages/user/create.vue
<script setup lang="ts">
  const { errorMessages, validate } = useCreateUserValidation()  // è¿½è¨˜
  const name = ref('')
  const email = ref('')
  const submit = () => {
    // ãƒ•ã‚©ãƒ¼ãƒ ã® submit æ™‚ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
    validate({
      name: name.value,
      email: email.value
    })
  }
</script>

<template>
  <div>
    <h1>ãƒ¦ãƒ¼ã‚¶ç™»éŒ²</h1>
    <v-sheet class="ma-4">
      <v-form @submit.prevent="submit">
        <v-row>
          <v-col cols="2">
            <v-list-subheader>
              ãƒ¦ãƒ¼ã‚¶å
            </v-list-subheader>
          </v-col>
          <v-col cols="10">
            <v-text-field
              v-model="name"
              label="ãƒ¦ãƒ¼ã‚¶å"
            >
            </v-text-field>

            <!-- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹ -->
            <template
              v-if="errorMessages && errorMessages.flatten().fieldErrors.name?.length"
            >
              <p
                class="text-red-lighten-1 mb-4"
                v-for="(error, i) in errorMessages.flatten().fieldErrors.name"
                :key="i"
              >
                {{ error }}
              </p>
            </template>
            <!--  -->
          </v-col>
        </v-row>
        <v-row>
          <v-col cols="2">
            <v-list-subheader>
              ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
            </v-list-subheader>
          </v-col>
          <v-col cols="10">
            <v-text-field
              v-model="email"
              label="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"
              type="email"
            >
            </v-text-field>
            <template
              v-if="errorMessages && errorMessages.flatten().fieldErrors.email?.length"
            >
              <p
                class="text-red-lighten-1 mb-4"
                v-for="(error, i) in errorMessages.flatten().fieldErrors.email"
                :key="i"
              >
                {{ error }}
              </p>
            </template>
          </v-col>
        </v-row>
        <v-btn color="light-blue-accent-4" type="submit" class="mt-4 w-20">Submit</v-btn>
      </v-form>
    </v-sheet>
  </div>
</template>
```

ã“ã‚Œã«ã‚ˆã£ã¦ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/0a606d7e59cd-20230604.png)

## ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ—¥æœ¬èªã«ã™ã‚‹

ç¾çŠ¶ã ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒä¸Šè¨˜ã®ã‚ˆã†ã«è‹±èªã«ãªã£ã¦ã„ã‚‹ã®ã§æ—¥æœ¬èªã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

Zod ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹æ–¹æ³•ã¯ä»¥ä¸‹ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹ã¨ 3 ã¤ã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯ `Global error map` ã‚’æ¡ç”¨ã—ã¾ã™ã€‚

https://zod.dev/ERROR_HANDLING?id=error-map-priority

ã¾ãš `customErrorMap` ã‚’å®šç¾©ã—ã¾ã™ã€‚ãã®å¾Œã€ Zod ã® `setErrorMap` é–¢æ•°ã®å¼•æ•°ã«å…ˆã»ã©å®šç¾©ã—ãŸ `customErrorMap` ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã§ãã¾ã™ã€‚

```ts: schema/customErrorMap.ts
import { ErrorMapCtx, z } from 'zod'

const customErrorMap = (issue: any, ctx: ErrorMapCtx) => {
  switch (issue.code) {
    case z.ZodIssueCode.too_small:
      if(issue.minimum === 1) {
        return { message: "å…¥åŠ›å¿…é ˆé …ç›®ã§ã™" }
      }
      return { message: `${issue.minimum}ä»¥ä¸Šå…¥åŠ›ã—ã¦ãã ã•ã„` }
    case z.ZodIssueCode.invalid_string:
      if(issue.validation === "url") {
        return { message: "url ãŒä¸æ­£ãªå€¤ã§ã™" }
      }
      if(issue.validation === "email") {
        return { message: "email ãŒä¸æ­£ãªå€¤ã§ã™" }
      }
      if(issue.validation === "uuid") {
        return { message: "uuid ãŒä¸æ­£ãªå€¤ã§ã™" }
      }
    default:
      return { message: ctx.defaultError }
  }
}

export default z.setErrorMap(customErrorMap)
```

https://github.com/colinhacks/zod/blob/master/ERROR_HANDLING.md#customizing-errors-with-zoderrormap

`issue` ã®ä¸­èº«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€`code` ã®å€¤ã§ switch æ–‡ã‚’ä½œæˆã—ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¾ã™ã€‚

```json
{
  "code": "too_small",
  "minimum": 1,
  "type": "string",
  "inclusive": true,
  "exact": false,
  "path": ["name"]
}
```

å…ˆã»ã©ä½œæˆã—ãŸ `customErrorMap.ts` ã‚’ `user.ts` ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™

```ts: schema/user.ts
import z from 'zod'
import '@/schema/customErrorMap' // è¿½åŠ 

// çœç•¥
```

ã“ã‚Œã«ã‚ˆã£ã¦å…ˆã»ã©è‹±èªã«ãªã£ã¦ã„ãŸã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸæ—¥æœ¬èªã«ãªã‚Šã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/8cadc76cd5e4-20230604.png)

# ãŠã‚ã‚Šã«

ä»Šå›ã¯ã˜ã‚ã¦ Nuxt3 ã‚’ä½¿ã£ã¦ç°¡å˜ãª UI ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã—ãŸã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€layouts ã‚„ composables ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ©Ÿèƒ½ã‚’ä½“é¨“ã—ã¾ã—ãŸã€‚

Nuxt3 ã®ä¾¿åˆ©ãªæ©Ÿèƒ½ã¯ã¾ã ã¾ã ãŸãã•ã‚“ã‚ã‚‹ã®ã§ã€ã“ã‚Œã‹ã‚‰ã‚‚ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ã¦ã„ããŸã„ã§ã™ã€‚

# å‚è€ƒè¨˜äº‹

https://zenn.dev/one_dock/articles/ab6d178741956d

https://zenn.dev/s_takashi/articles/71c04d68e0c9c0

https://reffect.co.jp/html/zod-yup
